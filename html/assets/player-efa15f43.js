import{r as v,f as L,d as C,u as O,g as R,o as x,a as P,h as y,w as k,j as V,b as h,k as p,l as D,t as I,F as U,n as b,c as A,e as F,i as j}from"./i18n-7c594128.js";import{P as N,u as q,_ as M,E as T,a as J}from"./useMediaStream-5afc63a5.js";var r=(l=>(l[l.IDLE=0]="IDLE",l[l.Pulling=1]="Pulling",l[l.Success=2]="Success",l))(r||{});const m=v(0),z=l=>{const g={offerToReceiveAudio:!0,offerToReceiveVideo:!0};let e=null;const c=async(i,a)=>{let s="";const t=new URL(i);return t.protocol?(!t.protocol.includes("http")&&!t.protocol.includes("ws")&&(t.protocol="https",s=t.origin),(await fetch(s+"/x2rtc/v1/pullstream",{method:"POST",body:JSON.stringify({streamurl:i,sessionid:"",localsdp:a})})).json()):void 0},_=async i=>{if(m.value!==0)return;m.value=1;const a=i.replace(/\s/g,""),s={};console.log("RTCPeerConnection configuration:",s),e=new N(s),console.log("Created local peer connection object pc"),e.pc.addEventListener("iceconnectionstatechange",t=>{console.log(`ICE state: ${e==null?void 0:e.pc.iceConnectionState}`),e!=null&&e.isICEConnected&&(m.value=2)}),e.pc.addEventListener("track",t=>{console.log("Recv remote track",t.track),l&&l(t.track)});try{console.log("pc createOffer start"),e.onOffer=async t=>{const{errcode:o,remotesdp:u}=await c(a,t);o===0&&(console.log("pc setRemoteDescription start",u),await(e==null?void 0:e.setRemoteDescription(u)))},await e.createAndSendOffer(g)}catch(t){console.log(`Failed to create session description: ${t.toString()}`)}},d=()=>{e==null||e.close(),e=null,m.value=0};return{pullState:L(m),startPull:_,stopPull:d}},G={class:"flex"},H={class:"w-full flex items-center space-x-4"},K=C({__name:"PlayerAndPreview",setup(l){const{t:g}=O(),{localStream:e,addTrack:c}=q(),_=R(()=>!o.value),d=v(),i=n=>{c(n),w.value||(w.value=!0),b(()=>{d.value.srcObject=e.value})},{pullState:a,startPull:s,stopPull:t}=z(i),o=v(""),u=v(""),w=v(!1),S=async()=>{if(!/^(webrtc):\/\/.*/i.test(o.value))return u.value=g("publicError.invalidUrl");u.value="",a.value!==r.Pulling&&(a.value===r.IDLE?await s(o.value):a.value===r.Success&&t())};return(n,E)=>{const B=T,$=J;return x(),P(U,null,[y(M,{"default-tips":n.$t("previewTips"),"error-message":u.value},{default:k(()=>[w.value?(x(),P("video",{key:0,ref_key:"videoBox",ref:d,class:"w-full h-full",autoplay:"",playsinline:""},null,512)):V("",!0)]),_:1},8,["default-tips","error-message"]),h("div",G,[h("div",H,[y(B,{modelValue:o.value,"onUpdate:modelValue":E[0]||(E[0]=f=>o.value=f),class:"!h-[58px] placeholder-7E8181 text-A9ABAB",type:"primary",formatter:f=>f,parser:f=>f.replace(/\s/g,""),placeholder:n.$t("player.inputPlaceholder"),disabled:p(a)!==p(r).IDLE},null,8,["modelValue","formatter","parser","placeholder","disabled"]),y($,{class:"!h-[58px] !px-10",type:"primary",loading:p(a)===p(r).Pulling,disabled:_.value,onClick:S},{default:k(()=>[D(I(p(a)===p(r).Success?n.$t("player.stopBtn"):n.$t("player.startBtn")),1)]),_:1},8,["loading","disabled"])])])],64)}}}),Q={class:"w-full h-full max-h-screen flex justify-center bg-[#F1F1F1] py-20"},W={class:"container flex"},X={class:"h-full flex-1 flex flex-col space-y-7"},Y=C({__name:"App",setup(l){const c=new URL(window.location.href).searchParams.get("lang");return c&&A(c),(_,d)=>(x(),P("div",Q,[h("div",W,[h("div",X,[y(K)])])]))}});F(Y).use(j).mount("#app");
